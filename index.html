<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto FDV Estimator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js v4 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- Chart.js Datalabels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
        }
        .log-entry {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
        }
        .log-info { color: #3b82f6; }
        .log-success { color: #22c55e; }
        .log-warning { color: #f59e0b; }
        .log-error { color: #ef4444; }
        .log-calc { color: #8b5cf6; }
        
        /* Custom tooltip */
        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        .tooltip-container .tooltip-text {
            visibility: hidden;
            opacity: 0;
            width: 220px;
            background-color: #1f2937;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 10px;
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: normal;
            line-height: 1.4;
            transition: opacity 0.2s, visibility 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .tooltip-container .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
        }
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        /* Scenario button styles */
        .scenario-btn {
            color: #6b7280;
            background: transparent;
        }
        .scenario-btn:hover {
            background: rgba(0,0,0,0.05);
        }
        .scenario-btn.active-bearish {
            background: #fecaca;
            color: #dc2626;
            box-shadow: 0 1px 3px rgba(220, 38, 38, 0.3);
        }
        .scenario-btn.active-mid {
            background: #e9d5ff;
            color: #7c3aed;
            box-shadow: 0 1px 3px rgba(124, 58, 237, 0.3);
        }
        .scenario-btn.active-bullish {
            background: #bbf7d0;
            color: #16a34a;
            box-shadow: 0 1px 3px rgba(22, 163, 74, 0.3);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen py-8 px-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">üìä Crypto FDV Estimator</h1>
            <p class="text-gray-600">Estimation de la Fully Diluted Valuation bas√©e sur les revenus</p>
        </div>

        <!-- Controls -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <span class="text-sm text-gray-500">Derni√®re mise √† jour :</span>
                    <span id="lastUpdate" class="text-sm font-medium text-gray-700">-</span>
                </div>
                <div class="flex items-center gap-3">
                    <!-- Scenario Buttons -->
                    <div class="flex items-center gap-1 bg-gray-100 rounded-lg p-1">
                        <div class="tooltip-container">
                            <button id="scenarioBearish" onclick="setScenario('bearish')" 
                                class="scenario-btn px-3 py-1.5 rounded-md text-sm font-medium transition-all">
                                üêª Bearish
                            </button>
                            <span class="tooltip-text">Pr√©voit un -66% sur les frais post TGE (cas de Lighter)</span>
                        </div>
                        <div class="tooltip-container">
                            <button id="scenarioMid" onclick="setScenario('mid')" 
                                class="scenario-btn px-3 py-1.5 rounded-md text-sm font-medium transition-all">
                                üßô Mid
                            </button>
                            <span class="tooltip-text">Pr√©voit un -33% sur les frais post TGE</span>
                        </div>
                        <div class="tooltip-container">
                            <button id="scenarioBullish" onclick="setScenario('bullish')" 
                                class="scenario-btn px-3 py-1.5 rounded-md text-sm font-medium transition-all">
                                üêÇ Bullish
                            </button>
                            <span class="tooltip-text">Calcul√© par rapport aux frais actuels</span>
                        </div>
                    </div>
                    <button id="refreshBtn" onclick="loadAllData()" 
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-6 rounded-lg transition-colors flex items-center gap-2">
                        <svg id="refreshIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        <span id="refreshText">Actualiser les donn√©es</span>
                    </button>
                </div>
            </div>
            <!-- Loading Progress -->
            <div id="loadingProgress" class="hidden mt-4">
                <div class="flex items-center gap-3">
                    <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-indigo-600"></div>
                    <span id="loadingText" class="text-sm text-gray-600">Chargement...</span>
                </div>
                <div class="mt-2 bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-indigo-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Chart -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Graphique Revenu vs FDV (√âchelle Logarithmique)</h2>
            <div class="relative" style="height: 500px;">
                <canvas id="scatterChart"></canvas>
            </div>
            <div class="flex gap-6 mt-4 justify-center">
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 rounded-full bg-blue-500"></div>
                    <span class="text-sm text-gray-600">Token Live</span>
                </div>
                <div class="flex items-center gap-2">
                    <div id="legendEstimatedDot" class="w-4 h-4 rounded-full bg-green-500"></div>
                    <span class="text-sm text-gray-600">FDV Estim√©e</span>
                </div>
                <div class="flex items-center gap-2">
                    <div id="legendRatioLine" class="w-6 h-0.5 border-dashed border-t-2 border-green-500"></div>
                    <span class="text-sm text-gray-600">Ratio moyen pond√©r√©</span>
                </div>
            </div>
        </div>

        <!-- Table 1: Projets sans token (Pre-TGE) -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 overflow-x-auto">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">
                    <span class="inline-flex items-center gap-2">
                        <span id="badgeEstime" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">‚è≥ Estim√©</span>
                        Projets Pre-TGE
                    </span>
                </h2>
                <!-- Scenario Buttons (duplicated) -->
                <div class="flex items-center gap-1 bg-gray-100 rounded-lg p-1">
                    <div class="tooltip-container">
                        <button id="scenarioBearish2" onclick="setScenario('bearish')" 
                            class="scenario-btn px-3 py-1.5 rounded-md text-sm font-medium transition-all">
                            üêª Bearish
                        </button>
                        <span class="tooltip-text">Pr√©voit un -66% sur les frais post TGE (cas de Lighter)</span>
                    </div>
                    <div class="tooltip-container">
                        <button id="scenarioMid2" onclick="setScenario('mid')" 
                            class="scenario-btn px-3 py-1.5 rounded-md text-sm font-medium transition-all">
                            üßô Mid
                        </button>
                        <span class="tooltip-text">Pr√©voit un -33% sur les frais post TGE</span>
                    </div>
                    <div class="tooltip-container">
                        <button id="scenarioBullish2" onclick="setScenario('bullish')" 
                            class="scenario-btn px-3 py-1.5 rounded-md text-sm font-medium transition-all">
                            üêÇ Bullish
                        </button>
                        <span class="tooltip-text">Calcul√© par rapport aux frais actuels</span>
                    </div>
                </div>
            </div>
            <table class="w-full">
                <thead>
                    <tr class="border-b-2 border-gray-200">
                        <th class="text-left py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('name', 'preTGE')">
                            Projet <span id="sort-name-preTGE" class="text-gray-400">‚Üï</span>
                        </th>
                        <th class="text-right py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('fees7d', 'preTGE')">
                            Moy. 7j <span id="sort-fees7d-preTGE" class="text-gray-400">‚Üï</span>
                        </th>
                        <th class="text-right py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('annualRevenue', 'preTGE')">
                            Revenu Annuel <span id="sort-annualRevenue-preTGE" class="text-gray-400">‚Üï</span>
                        </th>
                        <th class="text-right py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('fdv', 'preTGE')">
                            FDV <span id="sort-fdv-preTGE" class="text-gray-400">‚Üï</span>
                        </th>
                        <th class="text-right py-3 px-4">
                            <div class="flex flex-col items-end gap-1">
                                <button onclick="resetRatios(); event.stopPropagation();" class="text-xs bg-gray-200 hover:bg-gray-300 text-gray-600 px-2 py-0.5 rounded transition-colors" title="R√©initialiser les ratios">
                                    ‚Ü∫ Reset
                                </button>
                                <span class="cursor-pointer" onclick="sortTable('ratio', 'preTGE')">
                                    Ratio <span id="sort-ratio-preTGE" class="text-gray-400">‚Üï</span>
                                </span>
                            </div>
                        </th>
                        <th class="text-center py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('pointsSeason', 'preTGE')">
                            <div class="tooltip-container">
                                D√©but points <span id="sort-pointsSeason-preTGE" class="text-gray-400">‚Üï</span>
                                <span class="tooltip-text">Jours depuis le d√©but de la derni√®re saison de points</span>
                            </div>
                        </th>
                        <th class="text-right py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('pointsMax', 'preTGE')">
                            <div class="tooltip-container">
                                Points au TGE <span id="sort-pointsMax-preTGE" class="text-gray-400">‚Üï</span>
                                <span class="tooltip-text">Points max en circulation √† l'Airdrop</span>
                            </div>
                        </th>
                        <th class="text-right py-3 px-4">
                            <div class="flex flex-col items-end gap-1">
                                <div class="flex items-center gap-1 text-xs text-gray-500">
                                    <span>d√©faut:</span>
                                    <input 
                                        type="number" 
                                        id="defaultAirdropInput"
                                        value="10"
                                        min="1" 
                                        max="100"
                                        class="w-10 text-center border border-gray-300 rounded px-1 py-0.5 text-xs"
                                        onchange="updateDefaultAirdrop(this.value)"
                                        onclick="event.stopPropagation()"
                                    />
                                    <span>%</span>
                                </div>
                                <div class="tooltip-container">
                                    <span class="cursor-pointer" onclick="sortTable('airdropPct', 'preTGE')">
                                        %Airdrop <span id="sort-airdropPct-preTGE" class="text-gray-400">‚Üï</span>
                                    </span>
                                    <span class="tooltip-text">% du supply allou√© √† l'airdrop au TGE</span>
                                </div>
                            </div>
                        </th>
                        <th class="text-right py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('pointValue', 'preTGE')">
                            <div class="tooltip-container">
                                $/Point <span id="sort-pointValue-preTGE" class="text-gray-400">‚Üï</span>
                                <span class="tooltip-text">Valeur estim√©e d'un point = (FDV √ó %Airdrop) / Points Max</span>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody id="dataTablePreTGE">
                    <tr>
                        <td colspan="9" class="text-center py-8 text-gray-500">
                            Chargement des donn√©es...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Table 2: Projets avec token (Post-TGE) -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 overflow-x-auto">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
                <span class="inline-flex items-center gap-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">‚úì Live</span>
                    Projets Post-TGE
                </span>
            </h2>
            <table class="w-full">
                <thead>
                    <tr class="border-b-2 border-gray-200">
                        <th class="text-left py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('name', 'postTGE')">
                            Projet <span id="sort-name-postTGE" class="text-gray-400">‚Üï</span>
                        </th>
                        <th class="text-right py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('fees7d', 'postTGE')">
                            Moy. 7j <span id="sort-fees7d-postTGE" class="text-gray-400">‚Üï</span>
                        </th>
                        <th class="text-right py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('annualRevenue', 'postTGE')">
                            Revenu Annuel <span id="sort-annualRevenue-postTGE" class="text-gray-400">‚Üï</span>
                        </th>
                        <th class="text-right py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('fdv', 'postTGE')">
                            FDV <span id="sort-fdv-postTGE" class="text-gray-400">‚Üï</span>
                        </th>
                        <th class="text-right py-3 px-4 cursor-pointer hover:bg-gray-50" onclick="sortTable('ratio', 'postTGE')">
                            Ratio <span id="sort-ratio-postTGE" class="text-gray-400">‚Üï</span>
                        </th>
                    </tr>
                </thead>
                <tbody id="dataTablePostTGE">
                    <tr>
                        <td colspan="5" class="text-center py-8 text-gray-500">
                            Chargement des donn√©es...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Debug Logs -->
        <div class="bg-white rounded-xl shadow-lg mb-6">
            <button onclick="toggleLogs()" class="w-full p-4 text-left flex items-center justify-between hover:bg-gray-50 rounded-xl">
                <span class="font-semibold text-gray-800">üîß Logs de Debug</span>
                <svg id="logsArrow" class="w-5 h-5 text-gray-500 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            <div id="logsContainer" class="hidden border-t border-gray-200">
                <div class="p-4 max-h-96 overflow-y-auto bg-gray-900 rounded-b-xl">
                    <pre id="logs" class="log-entry text-gray-300 whitespace-pre-wrap"></pre>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-gray-500 text-sm">
            <p>Donn√©es fournies par DeFiLlama & CoinGecko</p>
            <p class="mt-1">Actualisation automatique toutes les 24h</p>
        </div>
    </div>

    <script>
        // =====================================================
        // CONFIGURATION DES PROJETS
        // =====================================================
        const PROJECTS = {
            // Projets avec token (slug DeFiLlama / id CoinGecko)
            withToken: [
                { name: 'Hyperliquid', llamaSlug: 'hyperliquid', coingeckoId: 'hyperliquid', pointsSeasonStart: '2024-11-29', pointsInfo: 'Possible S3 en cours depuis le TGE', pointsMax: null, airdropPct: 31 }, // Airdrop Genesis 31%
                { name: 'Lighter', llamaSlug: 'lighter', coingeckoId: 'lighter', pointsSeasonStart: '2025-10-02', pointsMax: null, airdropPct: 25 }, // 25% airdrop S1+S2
                { name: 'Aster', llamaSlug: 'aster', coingeckoId: 'aster-2', pointsSeasonStart: null, pointsMax: null, airdropPct: null },
                { name: 'dYdX', llamaSlug: 'dydx', coingeckoId: 'dydx-chain', pointsSeasonStart: null, pointsMax: null, airdropPct: null },
                { name: 'Avantis', llamaSlug: 'avantis', coingeckoId: 'avantis', pointsSeasonStart: '2025-09-03', pointsMax: null, airdropPct: null }, // Season 3
                { name: 'ApeX', llamaSlug: 'apex-omni', coingeckoContract: '0x52a8845df664d76c69d2eea607cd793565af42b8', pointsSeasonStart: '2025-10-06', pointsMax: null, airdropPct: null }, // Ape Season 1
                { name: 'Orderly', llamaSlug: 'orderly', coingeckoId: 'orderly-network', pointsSeasonStart: null, pointsMax: null, airdropPct: null },
                { name: 'GMX', llamaSlug: 'gmx', coingeckoId: 'gmx', pointsSeasonStart: null, pointsMax: null, airdropPct: null },
                { name: 'Drift', llamaSlug: 'drift', coingeckoId: 'drift-protocol', pointsSeasonStart: null, pointsMax: null, airdropPct: null },
            ],
            // Projets sans token (FDV estim√©e)
            withoutToken: [
                { name: 'Extended', llamaSlug: 'extended', pointsSeasonStart: '2025-04-29', pointsMax: 70000000, pointsMaxInfo: 'Bas√© sur les annonces Discord hebdo + 1.2M points/semaine jusqu\'√† fin Q2 26', airdropPct: 30 }, // 30% confirm√©
                { name: 'Paradex', llamaSlug: 'paradex', pointsSeasonStart: '2025-01-03', pointsMax: 310000000, pointsMaxInfo: '100M points S1 + 400k points/semaine S2, fin estim√©e 31 Jan 2026', airdropPct: 20 }, // 20% Genesis Airdrop
                { name: 'EdgeX', llamaSlug: 'edgex', pointsSeasonStart: '2025-12-11', pointsMax: null, airdropPct: 25 }, // ~25% estim√©
                { name: 'Ethereal', llamaSlug: 'ethereal-dex', pointsSeasonStart: '2025-08-14', pointsMax: null, airdropPct: null }, // Non communiqu√©
                { name: 'Ostium', llamaSlug: 'ostium', pointsSeasonStart: '2025-03-31', pointsMax: 55000000, pointsMaxInfo: '30M points S1 (estim√©) + 25M points S2 (hardcap)', airdropPct: null }, // Non annonc√©
                { name: 'Unit', llamaSlug: 'unit', pointsSeasonStart: '2025-06-01', pointsInfo: 'Possible campagne de points cach√©e', pointsMax: null, airdropPct: null },
                { name: 'tradeXYZ', llamaSlug: 'tradexyz', pointsSeasonStart: '2025-10-13', pointsInfo: 'Possible campagne de points cach√©e', pointsMax: null, airdropPct: null },
                { name: 'GRVT', llamaSlug: 'grvt', customApi: 'grvt', pointsSeasonStart: '2025-09-23', pointsMax: null, airdropPct: 22 }, // 22% (S1 10% + S2 12%) - points S1 non comparables √† S2
                { name: 'Reya', llamaSlug: 'reya', pointsSeasonStart: '2025-07-19', pointsMax: null, airdropPct: 45 }, // 45% communaut√© - 6.25M RCP initial mais distribution continue
                { name: 'Variational', llamaSlug: 'variational', customApi: 'variational', pointsSeasonStart: '2025-12-17', pointsMax: 9000000, pointsMaxInfo: 'Source : Donn√©es dispo dans la doc du projet', airdropPct: 25 }, // 25% estim√©
                // { name: 'StandX', llamaSlug: 'standx', customApi: 'standx', pointsSeasonStart: null, pointsMax: null, airdropPct: null }, // Pas de donn√©es DeFiLlama
                // { name: 'Polynomial', llamaSlug: 'polynomial-trade', pointsSeasonStart: null, pointsMax: null, airdropPct: null }, // Pas de fees sur DeFiLlama
                { name: 'Vest', llamaSlug: 'vest-exchange', pointsSeasonStart: null, pointsMax: null, airdropPct: null },
                { name: 'HyENA', llamaSlug: 'hyena', pointsSeasonStart: '2025-12-09', pointsMax: null, airdropPct: null },
                { name: 'Nado', llamaSlug: 'nado-perps', pointsSeasonStart: '2025-11-21', pointsMax: null, airdropPct: null },
            ]
        };

        // =====================================================
        // VARIABLES GLOBALES
        // =====================================================
        let projectsData = [];
        let currentSortPreTGE = { column: 'annualRevenue', direction: 'desc' };
        let currentSortPostTGE = { column: 'annualRevenue', direction: 'desc' };
        let chart = null;
        let originalAvgRatio = null; // Ratio calcul√© automatiquement (ne change jamais apr√®s calcul initial)
        let currentAvgRatio = null; // Ratio actuellement utilis√© (peut √™tre manuel)
        let manualRatio = null; // Ratio d√©fini manuellement par l'utilisateur
        let defaultAirdropPct = 10; // % Airdrop par d√©faut pour les projets sans info
        let currentScenario = 'bullish'; // Sc√©nario actuel (bearish, mid, bullish)
        let currentScenarioColor = 'rgba(22, 163, 74, 0.9)'; // Couleur actuelle du sc√©nario
        const scenarioMultipliers = {
            bearish: 1/3,  // -66% sur les frais post TGE
            mid: 2/3,      // -33% sur les frais post TGE
            bullish: 1     // Frais actuels
        };
        const scenarioColorsRGB = {
            bearish: { r: 220, g: 38, b: 38 },   // Rouge
            mid: { r: 124, g: 58, b: 237 },      // Violet
            bullish: { r: 22, g: 163, b: 74 }    // Vert
        };
        const scenarioTextClasses = {
            bearish: { text: 'text-red-600', bg: 'bg-red-50', textDark: 'text-red-700' },
            mid: { text: 'text-purple-600', bg: 'bg-purple-50', textDark: 'text-purple-700' },
            bullish: { text: 'text-green-600', bg: 'bg-green-50', textDark: 'text-green-700' }
        };

        // =====================================================
        // FONCTIONS UTILITAIRES
        // =====================================================
        
        // Formatage des nombres en USD avec B/M/K
        function formatUSD(value) {
            if (value === null || value === undefined || isNaN(value)) return '-';
            if (value >= 1e9) return '$' + (value / 1e9).toFixed(2) + 'B';
            if (value >= 1e6) return '$' + (value / 1e6).toFixed(2) + 'M';
            if (value >= 1e3) return '$' + (value / 1e3).toFixed(2) + 'K';
            return '$' + value.toFixed(2);
        }

        // Formatage des grands nombres (sans devise)
        function formatNumber(value) {
            if (value === null || value === undefined || isNaN(value)) return '-';
            if (value >= 1e9) return (value / 1e9).toFixed(1) + 'B';
            if (value >= 1e6) return (value / 1e6).toFixed(1) + 'M';
            if (value >= 1e3) return (value / 1e3).toFixed(1) + 'K';
            return value.toString();
        }

        // Formatage du ratio
        function formatRatio(value) {
            if (value === null || value === undefined || isNaN(value) || !isFinite(value)) return '-';
            return value.toFixed(1) + 'x';
        }

        // Calculer la valeur d'un point: (FDV √ó %Airdrop) / Points Max
        function calculatePointValue(project) {
            if (!project.fdv || !project.pointsMax) return null;
            const airdropPct = project.airdropPct !== null ? project.airdropPct : defaultAirdropPct;
            const pointValue = (project.fdv * (airdropPct / 100)) / project.pointsMax;
            return pointValue;
        }

        // Formatage de la valeur d'un point
        function formatPointValue(value) {
            if (value === null || value === undefined || isNaN(value)) return '-';
            if (value >= 1000) return '$' + (value / 1000).toFixed(1) + 'K';
            if (value >= 1) return '$' + value.toFixed(2);
            if (value >= 0.01) return '$' + value.toFixed(3);
            if (value >= 0.001) return '$' + value.toFixed(4);
            return '$' + value.toFixed(5);
        }

        // Calculer le nombre de jours depuis une date
        function daysSince(dateStr) {
            if (!dateStr) return null;
            const date = new Date(dateStr);
            const today = new Date();
            const diffTime = today - date;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Ajouter un log
        function addLog(message, type = 'info') {
            const logsEl = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString('fr-FR');
            const colorClass = {
                info: 'log-info',
                success: 'log-success',
                warning: 'log-warning',
                error: 'log-error',
                calc: 'log-calc'
            }[type] || 'log-info';
            
            logsEl.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            logsEl.scrollTop = logsEl.scrollHeight;
        }

        // Basculer l'affichage des logs
        function toggleLogs() {
            const container = document.getElementById('logsContainer');
            const arrow = document.getElementById('logsArrow');
            container.classList.toggle('hidden');
            arrow.classList.toggle('rotate-180');
        }

        // =====================================================
        // APPELS API
        // =====================================================
        
        // R√©cup√©rer les fees depuis DeFiLlama via notre Edge Function
        async function fetchFees(protocol) {
            try {
                addLog(`üì° Appel API fees pour: ${protocol}`, 'info');
                const response = await fetch(`/api/fees?protocol=${encodeURIComponent(protocol)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                addLog(`‚úÖ Fees ${protocol}: 24h=${formatUSD(data.total24h)}, 7d=${formatUSD(data.total7d)}`, 'success');
                return data;
            } catch (error) {
                addLog(`‚ùå Erreur fees ${protocol}: ${error.message}`, 'error');
                return null;
            }
        }

        // R√©cup√©rer la FDV depuis CoinGecko via notre Edge Function
        async function fetchFDV(coinId, contractAddress = null) {
            try {
                let url;
                let logId = coinId || contractAddress;
                
                if (contractAddress) {
                    addLog(`üì° Appel API CoinGecko par contrat: ${contractAddress.substring(0, 10)}...`, 'info');
                    url = `/api/coingecko?contract=${encodeURIComponent(contractAddress)}`;
                } else {
                    addLog(`üì° Appel API CoinGecko pour: ${coinId}`, 'info');
                    url = `/api/coingecko?coinId=${encodeURIComponent(coinId)}`;
                }
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                addLog(`‚úÖ FDV ${data.name || logId}: ${formatUSD(data.fdv)}, MC=${formatUSD(data.marketCap)}`, 'success');
                return data;
            } catch (error) {
                addLog(`‚ùå Erreur CoinGecko ${coinId || contractAddress}: ${error.message}`, 'error');
                return null;
            }
        }

        // R√©cup√©rer les donn√©es Variational via notre Edge Function custom
        async function fetchVariational() {
            try {
                addLog(`üì° Appel API Variational...`, 'info');
                const response = await fetch('/api/variational');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                addLog(`‚úÖ Variational: Loss Refund 24h=${formatUSD(data.lossRefund24h)}, Fees (x10)=${formatUSD(data.total24h)}`, 'success');
                return data;
            } catch (error) {
                addLog(`‚ùå Erreur Variational: ${error.message}`, 'error');
                return null;
            }
        }

        // R√©cup√©rer les donn√©es GRVT via notre Edge Function custom
        async function fetchGRVT() {
            try {
                addLog(`üì° Appel API GRVT...`, 'info');
                const response = await fetch('/api/grvt');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                addLog(`‚úÖ GRVT: Volume 24h=${formatUSD(data.volume24h)}, Fees (0.02%)=${formatUSD(data.total24h)}`, 'success');
                return data;
            } catch (error) {
                addLog(`‚ùå Erreur GRVT: ${error.message}`, 'error');
                return null;
            }
        }

        // R√©cup√©rer les donn√©es StandX via notre Edge Function custom
        async function fetchStandX() {
            try {
                addLog(`üì° Appel API StandX...`, 'info');
                const response = await fetch('/api/standx');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                addLog(`‚úÖ StandX: Volume 24h=${formatUSD(data.volume24h)}, Fees (0.025%)=${formatUSD(data.total24h)}`, 'success');
                return data;
            } catch (error) {
                addLog(`‚ùå Erreur StandX: ${error.message}`, 'error');
                return null;
            }
        }

        // =====================================================
        // CALCUL DU RATIO MOYEN POND√âR√â
        // =====================================================
        
        function calculateWeightedAverageRatio(data) {
            // Filtrer les projets avec token et donn√©es valides
            const validData = data.filter(p => p.hasToken && p.annualRevenue > 0 && p.fdv > 0);
            
            if (validData.length < 1) {
                addLog('‚ö†Ô∏è Pas assez de donn√©es pour calculer le ratio moyen', 'warning');
                return null;
            }

            addLog(`üìä Calcul du ratio moyen pond√©r√© avec ${validData.length} projets`, 'calc');

            // Calculer le ratio de chaque projet
            validData.forEach(p => {
                const ratio = p.fdv / p.annualRevenue;
                addLog(`   - ${p.name}: FDV=${formatUSD(p.fdv)} / Rev=${formatUSD(p.annualRevenue)} = ${ratio.toFixed(1)}x (poids: ${formatUSD(p.annualRevenue)})`, 'calc');
            });

            // Ratio moyen pond√©r√© par le revenu
            // Formule: Œ£(ratio_i √ó revenu_i) / Œ£(revenu_i)
            const totalWeightedRatio = validData.reduce((sum, p) => {
                const ratio = p.fdv / p.annualRevenue;
                return sum + (ratio * p.annualRevenue);
            }, 0);
            
            const totalRevenue = validData.reduce((sum, p) => sum + p.annualRevenue, 0);
            
            const weightedAverageRatio = totalWeightedRatio / totalRevenue;

            addLog(`üìà Ratio moyen pond√©r√©: ${weightedAverageRatio.toFixed(1)}x`, 'calc');
            addLog(`üìà Formule d'estimation: FDV = Revenu √ó ${weightedAverageRatio.toFixed(1)}`, 'calc');

            return weightedAverageRatio;
        }

        // Estimer la FDV bas√©e sur le revenu et le ratio moyen
        function estimateFDV(annualRevenue, ratio) {
            if (!ratio || annualRevenue <= 0) return null;
            return annualRevenue * ratio;
        }

        // =====================================================
        // CHARGEMENT DES DONN√âES
        // =====================================================
        
        async function loadAllData() {
            const refreshBtn = document.getElementById('refreshBtn');
            const refreshIcon = document.getElementById('refreshIcon');
            const refreshText = document.getElementById('refreshText');
            const loadingProgress = document.getElementById('loadingProgress');
            const loadingText = document.getElementById('loadingText');
            const progressBar = document.getElementById('progressBar');
            
            // UI de chargement
            refreshBtn.disabled = true;
            refreshBtn.classList.add('opacity-50', 'cursor-not-allowed');
            refreshIcon.classList.add('animate-spin');
            refreshText.textContent = 'Chargement...';
            loadingProgress.classList.remove('hidden');
            
            // Effacer les logs pr√©c√©dents
            document.getElementById('logs').innerHTML = '';
            addLog('üöÄ D√©but du chargement des donn√©es...', 'info');
            
            projectsData = [];
            const allProjects = [
                ...PROJECTS.withToken.map(p => ({ ...p, hasToken: true })),
                ...PROJECTS.withoutToken.map(p => ({ ...p, hasToken: false }))
            ];
            
            const totalSteps = allProjects.length + PROJECTS.withToken.length;
            let currentStep = 0;

            // 1. R√©cup√©rer les fees pour tous les projets
            addLog('üì• √âtape 1: R√©cup√©ration des fees (DeFiLlama)...', 'info');
            
            for (const project of allProjects) {
                loadingText.textContent = `Chargement fees: ${project.name}...`;
                
                let feesData;
                
                // Cas sp√©cial pour les APIs custom
                if (project.customApi === 'variational') {
                    feesData = await fetchVariational();
                } else if (project.customApi === 'grvt') {
                    feesData = await fetchGRVT();
                } else if (project.customApi === 'standx') {
                    feesData = await fetchStandX();
                } else {
                    feesData = await fetchFees(project.llamaSlug);
                }
                
                const daily7dAvg = feesData?.total7d ? feesData.total7d / 7 : 0;
                const annualRevenue = daily7dAvg * 365;
                
                projectsData.push({
                    name: project.name,
                    llamaSlug: project.llamaSlug,
                    coingeckoId: project.coingeckoId || null,
                    hasToken: project.hasToken,
                    customApi: project.customApi || false, // Flag pour APIs custom
                    pointsSeasonStart: project.pointsSeasonStart || null, // Date de d√©but de la saison de points
                    pointsInfo: project.pointsInfo || null, // Info suppl√©mentaire sur les points
                    pointsMax: project.pointsMax || null, // Max de points en circulation √† l'Airdrop
                    pointsMaxInfo: project.pointsMaxInfo || null, // Info suppl√©mentaire sur le max de points
                    airdropPct: project.airdropPct || null, // % du supply allou√© √† l'airdrop au TGE (null = utilise default)
                    fees24h: feesData?.total24h || 0,
                    fees7d: feesData?.total7d || 0,
                    fees7dAvg: daily7dAvg,
                    annualRevenue: annualRevenue,
                    fdv: null,
                    fdvEstimated: false,
                    ratio: null,
                    logo: feesData?.logo || null
                });
                
                currentStep++;
                progressBar.style.width = `${(currentStep / totalSteps) * 100}%`;
                
                // Petite pause pour √©viter le rate limiting
                await new Promise(r => setTimeout(r, 100));
            }

            // 2. R√©cup√©rer les FDV pour les projets avec token
            addLog('üì• √âtape 2: R√©cup√©ration des FDV (CoinGecko)...', 'info');
            
            for (const project of PROJECTS.withToken) {
                loadingText.textContent = `Chargement FDV: ${project.name}...`;
                
                // Support both coingeckoId and coingeckoContract
                let fdvData;
                if (project.coingeckoContract) {
                    fdvData = await fetchFDV(null, project.coingeckoContract);
                } else if (project.coingeckoId) {
                    fdvData = await fetchFDV(project.coingeckoId);
                }
                
                const projectData = projectsData.find(p => p.llamaSlug === project.llamaSlug);
                if (projectData && fdvData) {
                    projectData.fdv = fdvData.fdv;
                    // Utiliser le logo CoinGecko si pas de logo DeFiLlama
                    if (!projectData.logo && fdvData.image) {
                        projectData.logo = fdvData.image;
                    }
                    if (projectData.fdv > 0 && projectData.annualRevenue > 0) {
                        projectData.ratio = projectData.fdv / projectData.annualRevenue;
                    }
                }
                
                currentStep++;
                progressBar.style.width = `${(currentStep / totalSteps) * 100}%`;
                
                // Petite pause pour √©viter le rate limiting
                await new Promise(r => setTimeout(r, 300));
            }

            // 3. Calculer le ratio moyen et estimer les FDV
            addLog('üì• √âtape 3: Calcul des estimations...', 'info');
            loadingText.textContent = 'Calcul du ratio moyen...';
            
            const avgRatio = calculateWeightedAverageRatio(projectsData);
            const scenarioMultiplier = scenarioMultipliers[currentScenario];
            
            // Appliquer les estimations aux projets sans token (avec multiplicateur du sc√©nario)
            for (const project of projectsData) {
                if (!project.hasToken && project.annualRevenue > 0) {
                    const estimatedFDV = estimateFDV(project.annualRevenue, avgRatio * scenarioMultiplier);
                    if (estimatedFDV) {
                        project.fdv = estimatedFDV;
                        project.fdvEstimated = true;
                        project.ratio = project.fdv / project.annualRevenue;
                        addLog(`üí° Estimation ${project.name}: FDV=${formatUSD(estimatedFDV)}, Ratio=${formatRatio(project.ratio)}`, 'calc');
                    }
                }
            }
            
            // Stocker le ratio original (ne sera jamais modifi√©)
            originalAvgRatio = avgRatio;
            currentAvgRatio = avgRatio;

            // Identifier les projets exclus
            const excluded = projectsData.filter(p => p.annualRevenue <= 0);
            if (excluded.length > 0) {
                addLog(`‚ö†Ô∏è Projets exclus du graphique (revenus ‚â§ 0): ${excluded.map(p => p.name).join(', ')}`, 'warning');
            }

            // 4. Mettre √† jour l'affichage
            addLog('üé® Mise √† jour de l\'interface...', 'info');
            updateTable();
            await updateChart(avgRatio * scenarioMultipliers[currentScenario], currentScenario);
            
            // Mettre √† jour la date
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('fr-FR');
            
            // Reset UI
            refreshBtn.disabled = false;
            refreshBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            refreshIcon.classList.remove('animate-spin');
            refreshText.textContent = 'Actualiser les donn√©es';
            loadingProgress.classList.add('hidden');
            
            addLog('‚úÖ Chargement termin√©!', 'success');
        }

        // =====================================================
        // MISE √Ä JOUR DU TABLEAU
        // =====================================================
        
        function sortData(data, currentSort) {
            return [...data].sort((a, b) => {
                let valA, valB;
                
                switch (currentSort.column) {
                    case 'name':
                        valA = a.name.toLowerCase();
                        valB = b.name.toLowerCase();
                        break;
                    case 'fees7d':
                        valA = a.fees7dAvg || 0;
                        valB = b.fees7dAvg || 0;
                        break;
                    case 'annualRevenue':
                        valA = a.annualRevenue || 0;
                        valB = b.annualRevenue || 0;
                        break;
                    case 'fdv':
                        valA = a.fdv || 0;
                        valB = b.fdv || 0;
                        break;
                    case 'ratio':
                        valA = a.ratio || 0;
                        valB = b.ratio || 0;
                        break;
                    case 'pointsSeason':
                        valA = a.pointsSeasonStart ? daysSince(a.pointsSeasonStart) : -9999;
                        valB = b.pointsSeasonStart ? daysSince(b.pointsSeasonStart) : -9999;
                        break;
                    case 'pointsMax':
                        valA = a.pointsMax || -1;
                        valB = b.pointsMax || -1;
                        break;
                    case 'airdropPct':
                        valA = a.airdropPct !== null ? a.airdropPct : defaultAirdropPct;
                        valB = b.airdropPct !== null ? b.airdropPct : defaultAirdropPct;
                        break;
                    case 'pointValue':
                        valA = calculatePointValue(a) || -1;
                        valB = calculatePointValue(b) || -1;
                        break;
                    default:
                        return 0;
                }
                
                if (typeof valA === 'string') {
                    return currentSort.direction === 'asc' 
                        ? valA.localeCompare(valB) 
                        : valB.localeCompare(valA);
                }
                
                return currentSort.direction === 'asc' ? valA - valB : valB - valA;
            });
        }
        
        function generateRowHTML(project, isPreTGE) {
            const ratioValue = project.fdvEstimated 
                ? (manualRatio !== null ? manualRatio : Math.round(project.ratio))
                : Math.round(project.ratio);
            
            // Tooltip personnalis√© selon le type d'API custom
            let customApiTooltip = '';
            if (project.customApi === 'variational') {
                customApiTooltip = 'Donn√©es via API custom<br>(Fees = Loss Refund √ó 10)<br>Bas√© sur 24h glissantes';
            } else if (project.customApi === 'grvt') {
                customApiTooltip = 'Donn√©es via API custom<br>(Fees = Volume √ó 0.02%)<br>Bas√© sur 24h glissantes';
            } else if (project.customApi === 'standx') {
                customApiTooltip = 'Donn√©es via API custom<br>(Fees = Volume √ó 0.025%)<br>Maker 0.01% / Taker 0.04%';
            }
            
            // Colonnes communes
            const commonCols = `
                <td class="py-3 px-4">
                    <div class="flex items-center gap-2">
                        ${project.logo ? `<img src="${project.logo}" alt="${project.name}" class="w-6 h-6 rounded-full">` : ''}
                        <span class="font-medium text-gray-800">${project.name}</span>
                        ${project.customApi ? `
                            <span class="tooltip-container text-purple-600">
                                <span class="text-xs">‚ìò</span>
                                <span class="tooltip-text">${customApiTooltip}</span>
                            </span>
                        ` : ''}
                    </div>
                </td>
                <td class="text-right py-3 px-4 text-gray-600">
                    ${project.customApi 
                        ? `<span title="Estimation bas√©e sur 24h glissantes">${formatUSD(project.fees7dAvg)}*</span>`
                        : formatUSD(project.fees7dAvg)
                    }
                </td>
                <td class="text-right py-3 px-4 text-gray-600">
                    ${project.customApi 
                        ? `<span title="Estimation bas√©e sur 24h glissantes">${formatUSD(project.annualRevenue)}*</span>`
                        : formatUSD(project.annualRevenue)
                    }
                </td>
                <td class="text-right py-3 px-4">
                    <span class="${project.fdvEstimated ? scenarioTextClasses[currentScenario].text : 'text-gray-800'} font-medium">
                        ${formatUSD(project.fdv)}${project.fdvEstimated ? '*' : ''}
                    </span>
                </td>
            `;
            
            // Colonne Ratio (√©ditable seulement pour Pre-TGE)
            const ratioCol = isPreTGE ? `
                <td class="text-right py-3 px-4">
                    <div class="flex items-center justify-end">
                        <input type="text" 
                            value="${ratioValue || ''}" 
                            onchange="updateRatio(this.value)"
                            oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                            class="w-16 text-right px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${scenarioTextClasses[currentScenario].bg} ${scenarioTextClasses[currentScenario].textDark}"
                            title="Modifier pour recalculer les FDV estim√©es"
                        />
                        <span class="ml-1 text-gray-500">x</span>
                    </div>
                </td>
            ` : `
                <td class="text-right py-3 px-4">
                    <span class="text-gray-700">${ratioValue || '-'}x</span>
                </td>
            `;
            
            // Colonnes de points (seulement pour Pre-TGE)
            const pointsCols = isPreTGE ? `
                <td class="text-center py-3 px-4 text-sm">
                    ${project.pointsSeasonStart 
                        ? `<span class="text-indigo-700 font-medium">${daysSince(project.pointsSeasonStart)}j</span>${project.pointsInfo ? `
                            <span class="tooltip-container text-amber-600 ml-1">
                                <span class="text-xs">‚ìò</span>
                                <span class="tooltip-text">${project.pointsInfo}</span>
                            </span>` : ''}`
                        : '<span class="text-gray-400">-</span>'
                    }
                </td>
                <td class="text-right py-3 px-4 text-sm">
                    ${project.pointsMaxInfo 
                        ? `<span class="text-purple-700 font-medium">${formatNumber(project.pointsMax)}</span><span class="tooltip-container ml-1"><span class="text-gray-400 cursor-help">‚ìò</span><span class="tooltip-text">${project.pointsMaxInfo}</span></span>`
                        : `<div class="flex items-center justify-end gap-1">
                            <input type="number" 
                                   id="pointsMax-${project.name}" 
                                   class="w-16 px-1 py-0.5 text-right text-sm border border-gray-300 rounded bg-purple-50 focus:outline-none focus:ring-1 focus:ring-purple-400"
                                   placeholder="?"
                                   value="${project.pointsMax ? project.pointsMax / 1000000 : ''}"
                                   onchange="updatePointsMax('${project.name}', this.value)"
                                   title="Entrez le nombre de points en millions">
                            <span class="text-gray-500 text-xs">M</span>
                           </div>`
                    }
                </td>
                <td class="text-right py-3 px-4 text-sm">
                    ${project.airdropPct !== null 
                        ? `<span class="text-emerald-700 font-medium">${project.airdropPct}%</span>`
                        : `<span class="text-gray-500 italic">${defaultAirdropPct}%</span>`
                    }
                </td>
                <td class="text-right py-3 px-4 text-sm">
                    ${(() => {
                        const pointValue = calculatePointValue(project);
                        if (pointValue === null) {
                            return '<span class="text-gray-400">-</span>';
                        }
                        const hasAllData = project.pointsMax && (project.airdropPct !== null);
                        const colorClass = hasAllData ? 'text-cyan-700 font-medium' : 'text-gray-500 italic';
                        return `<span class="${colorClass}">${formatPointValue(pointValue)}</span>`;
                    })()}
                </td>
            ` : '';
            
            return `
                <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors">
                    ${commonCols}
                    ${ratioCol}
                    ${pointsCols}
                </tr>
            `;
        }
        
        function updateTable() {
            // S√©parer les projets Pre-TGE et Post-TGE
            const preTGEProjects = projectsData.filter(p => !p.hasToken);
            const postTGEProjects = projectsData.filter(p => p.hasToken);
            
            // Trier chaque groupe
            const sortedPreTGE = sortData(preTGEProjects, currentSortPreTGE);
            const sortedPostTGE = sortData(postTGEProjects, currentSortPostTGE);
            
            // Mettre √† jour le tableau Pre-TGE
            const tbodyPreTGE = document.getElementById('dataTablePreTGE');
            tbodyPreTGE.innerHTML = sortedPreTGE.map(project => generateRowHTML(project, true)).join('');
            
            // Mettre √† jour le tableau Post-TGE
            const tbodyPostTGE = document.getElementById('dataTablePostTGE');
            tbodyPostTGE.innerHTML = sortedPostTGE.map(project => generateRowHTML(project, false)).join('');

            // Mettre √† jour les indicateurs de tri pour Pre-TGE
            document.querySelectorAll('[id^="sort-"][id$="-preTGE"]').forEach(el => {
                el.textContent = '‚Üï';
                el.classList.remove('text-indigo-600');
                el.classList.add('text-gray-400');
            });
            const preTGESortEl = document.getElementById(`sort-${currentSortPreTGE.column}-preTGE`);
            if (preTGESortEl) {
                preTGESortEl.textContent = currentSortPreTGE.direction === 'asc' ? '‚Üë' : '‚Üì';
                preTGESortEl.classList.remove('text-gray-400');
                preTGESortEl.classList.add('text-indigo-600');
            }
            
            // Mettre √† jour les indicateurs de tri pour Post-TGE
            document.querySelectorAll('[id^="sort-"][id$="-postTGE"]').forEach(el => {
                el.textContent = '‚Üï';
                el.classList.remove('text-indigo-600');
                el.classList.add('text-gray-400');
            });
            const postTGESortEl = document.getElementById(`sort-${currentSortPostTGE.column}-postTGE`);
            if (postTGESortEl) {
                postTGESortEl.textContent = currentSortPostTGE.direction === 'asc' ? '‚Üë' : '‚Üì';
                postTGESortEl.classList.remove('text-gray-400');
                postTGESortEl.classList.add('text-indigo-600');
            }
        }

        function sortTable(column, tableType) {
            if (tableType === 'preTGE') {
                if (currentSortPreTGE.column === column) {
                    currentSortPreTGE.direction = currentSortPreTGE.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSortPreTGE.column = column;
                    currentSortPreTGE.direction = 'desc';
                }
            } else if (tableType === 'postTGE') {
                if (currentSortPostTGE.column === column) {
                    currentSortPostTGE.direction = currentSortPostTGE.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSortPostTGE.column = column;
                    currentSortPostTGE.direction = 'desc';
                }
            }
            updateTable();
        }

        // Mettre √† jour le ratio manuellement
        function updateRatio(value) {
            const newRatio = parseInt(value, 10);
            
            if (isNaN(newRatio) || newRatio <= 0) {
                addLog('‚ö†Ô∏è Ratio invalide, veuillez entrer un nombre entier positif', 'warning');
                updateTable(); // Rafra√Æchir pour remettre l'ancienne valeur
                return;
            }
            
            addLog(`üìù Ratio modifi√© manuellement: ${newRatio}x (original: ${Math.round(originalAvgRatio)}x)`, 'info');
            manualRatio = newRatio;
            currentAvgRatio = newRatio;
            
            // Recalculer les FDV estim√©es avec le nouveau ratio ET le sc√©nario actuel
            const multiplier = scenarioMultipliers[currentScenario];
            for (const project of projectsData) {
                if (project.fdvEstimated && project.annualRevenue > 0) {
                    project.fdv = project.annualRevenue * manualRatio * multiplier;
                    project.ratio = manualRatio * multiplier;
                    addLog(`üí° Recalcul ${project.name}: FDV=${formatUSD(project.fdv)}`, 'calc');
                }
            }
            
            // Mettre √† jour le tableau et le graphique
            updateTable();
            updateChart(manualRatio * multiplier, currentScenario);
        }
        
        // Mettre √† jour le pointsMax d'un projet (entr√©e utilisateur en millions)
        function updatePointsMax(projectName, valueInMillions) {
            const project = projectsData.find(p => p.name === projectName);
            if (!project) return;
            
            const numValue = parseFloat(valueInMillions);
            if (isNaN(numValue) || numValue <= 0) {
                project.pointsMax = null;
                addLog(`üîÑ ${projectName}: Points au TGE r√©initialis√©`, 'info');
            } else {
                project.pointsMax = numValue * 1000000; // Convertir millions en unit√©s
                addLog(`üìù ${projectName}: Points au TGE = ${numValue}M`, 'info');
            }
            
            updateTable();
        }
        
        // Changer le sc√©nario (bearish, mid, bullish)
        function setScenario(scenario) {
            currentScenario = scenario;
            const multiplier = scenarioMultipliers[scenario];
            const rgb = scenarioColorsRGB[scenario];
            currentScenarioColor = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.9)`;
            
            // Mettre √† jour les styles des deux sets de boutons
            const buttons = ['scenarioBearish', 'scenarioMid', 'scenarioBullish', 'scenarioBearish2', 'scenarioMid2', 'scenarioBullish2'];
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) {
                    const type = id.replace('2', '').replace('scenario', '').toLowerCase();
                    btn.className = 'scenario-btn px-3 py-1.5 rounded-md text-sm font-medium transition-all' + 
                        (scenario === type ? ` active-${type}` : '');
                }
            });
            
            // Mettre √† jour les couleurs de la l√©gende du graphique
            const legendDot = document.getElementById('legendEstimatedDot');
            const legendLine = document.getElementById('legendRatioLine');
            const badgeEstime = document.getElementById('badgeEstime');
            const scenarioTailwindColors = {
                bearish: { bg: 'bg-red-500', border: 'border-red-500', badgeBg: 'bg-red-100', badgeText: 'text-red-800' },
                mid: { bg: 'bg-purple-500', border: 'border-purple-500', badgeBg: 'bg-purple-100', badgeText: 'text-purple-800' },
                bullish: { bg: 'bg-green-500', border: 'border-green-500', badgeBg: 'bg-green-100', badgeText: 'text-green-800' }
            };
            if (legendDot) {
                legendDot.className = `w-4 h-4 rounded-full ${scenarioTailwindColors[scenario].bg}`;
            }
            if (legendLine) {
                legendLine.className = `w-6 h-0.5 border-dashed border-t-2 ${scenarioTailwindColors[scenario].border}`;
            }
            if (badgeEstime) {
                badgeEstime.className = `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${scenarioTailwindColors[scenario].badgeBg} ${scenarioTailwindColors[scenario].badgeText}`;
            }
            
            // Recalculer les FDV estim√©es avec le multiplicateur du sc√©nario
            const ratioToUse = manualRatio || originalAvgRatio;
            for (const project of projectsData) {
                if (project.fdvEstimated && project.annualRevenue > 0) {
                    project.fdv = project.annualRevenue * ratioToUse * multiplier;
                    project.ratio = ratioToUse * multiplier;
                }
            }
            
            const scenarioNames = { bearish: 'Bearish (-66%)', mid: 'Mid (-33%)', bullish: 'Bullish (100%)' };
            addLog(`üìä Sc√©nario chang√©: ${scenarioNames[scenario]}`, 'info');
            
            // Mettre √† jour le tableau et le graphique avec la couleur du sc√©nario
            updateTable();
            updateChart(ratioToUse * multiplier, scenario);
        }
        
        // R√©initialiser les ratios aux valeurs calcul√©es automatiquement
        function resetRatios() {
            if (originalAvgRatio === null) {
                addLog('‚ö†Ô∏è Pas de ratio original √† restaurer', 'warning');
                return;
            }
            
            addLog(`üîÑ R√©initialisation des ratios au ratio original: ${Math.round(originalAvgRatio)}x`, 'info');
            manualRatio = null;
            currentAvgRatio = originalAvgRatio;
            
            // Restaurer les ratios originaux pour les projets estim√©s avec le sc√©nario actuel
            const multiplier = scenarioMultipliers[currentScenario];
            for (const project of projectsData) {
                if (project.fdvEstimated && project.annualRevenue > 0) {
                    // Recalculer avec le ratio moyen original ET le sc√©nario
                    project.fdv = project.annualRevenue * originalAvgRatio * multiplier;
                    project.ratio = originalAvgRatio * multiplier;
                    addLog(`üîÑ Reset ${project.name}: FDV=${formatUSD(project.fdv)}, Ratio=${Math.round(project.ratio)}x`, 'calc');
                }
            }
            
            // Mettre √† jour le tableau et le graphique
            updateTable();
            updateChart(originalAvgRatio * multiplier, currentScenario);
            addLog('‚úÖ Ratios r√©initialis√©s au ratio moyen pond√©r√©', 'success');
        }

        // Mettre √† jour le % Airdrop par d√©faut
        function updateDefaultAirdrop(value) {
            const newDefault = parseInt(value, 10);
            
            if (isNaN(newDefault) || newDefault < 1 || newDefault > 100) {
                addLog('‚ö†Ô∏è % Airdrop invalide, veuillez entrer un nombre entre 1 et 100', 'warning');
                document.getElementById('defaultAirdropInput').value = defaultAirdropPct;
                return;
            }
            
            addLog(`üìù % Airdrop par d√©faut modifi√©: ${newDefault}% (pr√©c√©dent: ${defaultAirdropPct}%)`, 'info');
            defaultAirdropPct = newDefault;
            
            // Mettre √† jour le tableau pour refl√©ter le nouveau default
            updateTable();
        }

        // =====================================================
        // MISE √Ä JOUR DU GRAPHIQUE
        // =====================================================
        
        // Cache pour les images des logos
        let logoImages = {};
        
        // Pr√©charger les images des logos via le proxy pour √©viter CORS
        async function preloadLogos(projects) {
            const promises = projects.map(p => {
                return new Promise((resolve) => {
                    if (!p.logo) {
                        resolve();
                        return;
                    }
                    
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.onload = () => {
                        logoImages[p.name] = img;
                        addLog(`üñºÔ∏è Logo charg√©: ${p.name}`, 'success');
                        resolve();
                    };
                    img.onerror = () => {
                        addLog(`‚ö†Ô∏è Erreur chargement logo: ${p.name}`, 'warning');
                        resolve();
                    };
                    // Utiliser le proxy pour contourner CORS
                    img.src = `/api/logo?url=${encodeURIComponent(p.logo)}`;
                });
            });
            
            await Promise.all(promises);
        }
        
        // Variable pour stocker l'index du point survol√©
        let hoveredPoint = null;
        
        // Fonction pour calculer la distance entre deux points
        function getDistance(x1, y1, x2, y2) {
            return Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
        }
        
        // Fonction pour d√©tecter et r√©soudre les collisions statiques
        function resolveStaticCollisions(points, baseSize) {
            const minDistance = baseSize + 10; // Distance minimale entre les centres
            const offsets = points.map(() => ({ x: 0, y: 0 }));
            
            // Plusieurs passes pour r√©soudre les collisions
            for (let pass = 0; pass < 8; pass++) {
                for (let i = 0; i < points.length; i++) {
                    for (let j = i + 1; j < points.length; j++) {
                        const p1 = points[i];
                        const p2 = points[j];
                        
                        const x1 = p1.x + offsets[i].x;
                        const y1 = p1.y + offsets[i].y;
                        const x2 = p2.x + offsets[j].x;
                        const y2 = p2.y + offsets[j].y;
                        
                        const dist = getDistance(x1, y1, x2, y2);
                        
                        if (dist < minDistance && dist > 0) {
                            // Calculer le vecteur de s√©paration
                            const overlap = (minDistance - dist) / 2;
                            const dx = (x2 - x1) / dist;
                            const dy = (y2 - y1) / dist;
                            
                            // D√©caler les deux points
                            offsets[i].x -= dx * overlap * 0.6;
                            offsets[i].y -= dy * overlap * 0.6;
                            offsets[j].x += dx * overlap * 0.6;
                            offsets[j].y += dy * overlap * 0.6;
                        }
                    }
                }
            }
            
            return offsets;
        }
        
        // Plugin personnalis√© pour dessiner les logos avec anti-collision
        const logoPlugin = {
            id: 'logoPlugin',
            afterDraw: function(chart) {
                const ctx = chart.ctx;
                const baseSize = 28;
                
                // Collecter tous les points des datasets 1 et 2
                let allPoints = [];
                
                chart.data.datasets.forEach((dataset, datasetIndex) => {
                    if (datasetIndex === 0) return;
                    const meta = chart.getDatasetMeta(datasetIndex);
                    
                    meta.data.forEach((point, index) => {
                        const data = dataset.data[index];
                        if (!data || !data.name) return;
                        
                        allPoints.push({
                            x: point.x,
                            y: point.y,
                            data: data,
                            datasetIndex: datasetIndex,
                            index: index,
                            logoImg: logoImages[data.name],
                            hasToken: datasetIndex === 1
                        });
                    });
                });
                
                // Calculer les d√©calages statiques pour √©viter les superpositions
                const staticOffsets = resolveStaticCollisions(allPoints, baseSize);
                
                // Dessiner tous les points avec leurs d√©calages
                allPoints.forEach((point, i) => {
                    const x = point.x + staticOffsets[i].x;
                    const y = point.y + staticOffsets[i].y;
                    const logoImg = point.logoImg;
                    const hasToken = point.hasToken;
                    const data = point.data;
                    
                    // V√©rifier si ce point est survol√©
                    const isHovered = hoveredPoint && 
                        hoveredPoint.datasetIndex === point.datasetIndex && 
                        hoveredPoint.index === point.index;
                    
                    // Taille avec animation (grossissement au hover)
                    const size = isHovered ? baseSize * 1.3 : baseSize;
                    
                    // Couleur pour les projets estim√©s (bas√©e sur le sc√©nario)
                    const estimatedColor = currentScenarioColor;
                    const rgb = scenarioColorsRGB[currentScenario];
                    const estimatedColorLight = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.2)`;
                    const estimatedColorMid = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.5)`;
                    const estimatedColorHex = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                    
                    ctx.save();
                    
                    if (logoImg) {
                        // Dessiner un cercle de fond (bordure color√©e)
                        ctx.beginPath();
                        ctx.arc(x, y, size / 2 + 3, 0, Math.PI * 2);
                        ctx.fillStyle = hasToken ? 'rgba(59, 130, 246, 0.9)' : estimatedColor;
                        ctx.fill();
                        
                        // Ombre port√©e au hover
                        if (isHovered) {
                            ctx.shadowColor = hasToken ? 'rgba(59, 130, 246, 0.5)' : estimatedColorMid;
                            ctx.shadowBlur = 15;
                            ctx.shadowOffsetX = 0;
                            ctx.shadowOffsetY = 4;
                        }
                        
                        // Dessiner un cercle blanc derri√®re le logo
                        ctx.beginPath();
                        ctx.arc(x, y, size / 2 + 1, 0, Math.PI * 2);
                        ctx.fillStyle = '#ffffff';
                        ctx.fill();
                        
                        // Reset shadow pour le logo
                        ctx.shadowColor = 'transparent';
                        ctx.shadowBlur = 0;
                        
                        // Cr√©er un clip circulaire pour le logo
                        ctx.beginPath();
                        ctx.arc(x, y, size / 2, 0, Math.PI * 2);
                        ctx.clip();
                        
                        // Dessiner le logo
                        ctx.drawImage(logoImg, x - size / 2, y - size / 2, size, size);
                    } else {
                        // Fallback: dessiner un cercle color√© avec initiales
                        ctx.beginPath();
                        ctx.arc(x, y, size / 2 + 2, 0, Math.PI * 2);
                        ctx.fillStyle = hasToken ? 'rgba(59, 130, 246, 0.9)' : estimatedColor;
                        ctx.fill();
                        
                        // Ombre port√©e au hover
                        if (isHovered) {
                            ctx.shadowColor = hasToken ? 'rgba(59, 130, 246, 0.5)' : estimatedColorMid;
                            ctx.shadowBlur = 15;
                        }
                        
                        // Cercle int√©rieur blanc
                        ctx.beginPath();
                        ctx.arc(x, y, size / 2, 0, Math.PI * 2);
                        ctx.fillStyle = '#ffffff';
                        ctx.fill();
                        
                        // Reset shadow
                        ctx.shadowColor = 'transparent';
                        ctx.shadowBlur = 0;
                        
                        // Cercle int√©rieur color√©
                        ctx.beginPath();
                        ctx.arc(x, y, size / 2 - 2, 0, Math.PI * 2);
                        ctx.fillStyle = hasToken ? 'rgba(59, 130, 246, 0.2)' : estimatedColorLight;
                        ctx.fill();
                        
                        // Initiales du projet
                        ctx.fillStyle = hasToken ? '#3b82f6' : estimatedColorHex;
                        ctx.font = `bold ${isHovered ? 13 : 10}px Arial`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        const initials = data.name.substring(0, 2).toUpperCase();
                        ctx.fillText(initials, x, y);
                    }
                    
                    ctx.restore();
                });
                
                // Dessiner les labels au-dessus des points (apr√®s tous les logos pour qu'ils soient au-dessus)
                allPoints.forEach((point, i) => {
                    const x = point.x + staticOffsets[i].x;
                    const y = point.y + staticOffsets[i].y;
                    const hasToken = point.hasToken;
                    const data = point.data;
                    const baseSize = 28;
                    
                    // Couleur du label bas√©e sur le sc√©nario
                    const rgb = scenarioColorsRGB[currentScenario];
                    const labelColor = hasToken ? '#3b82f6' : `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                    
                    ctx.save();
                    ctx.fillStyle = labelColor;
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';
                    ctx.fillText(data.name, x, y - baseSize / 2 - 8);
                    ctx.restore();
                });
            }
        };
        
        // Couleurs des sc√©narios pour la ligne du ratio
        const scenarioColors = {
            bearish: 'rgba(220, 38, 38, 0.7)',   // Rouge
            mid: 'rgba(124, 58, 237, 0.7)',      // Violet
            bullish: 'rgba(22, 163, 74, 0.7)'    // Vert
        };

        async function updateChart(avgRatio, scenario = null) {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            
            // Stocker le ratio pour les redraws
            currentAvgRatio = avgRatio;
            
            // Utiliser le sc√©nario courant si non sp√©cifi√©
            const activeScenario = scenario || currentScenario;
            const lineColor = scenarioColors[activeScenario] || scenarioColors.bullish;

            // Filtrer les projets valides pour le graphique
            const validProjects = projectsData.filter(p => p.annualRevenue > 0 && p.fdv > 0);
            
            // Pr√©parer les donn√©es
            const liveTokens = validProjects.filter(p => p.hasToken);
            const estimatedTokens = validProjects.filter(p => !p.hasToken);

            // Pr√©parer les donn√©es de la ligne du ratio moyen
            let ratioLine = [];
            if (avgRatio) {
                // Trouver les min/max des revenus
                const revenues = validProjects.map(p => p.annualRevenue);
                const minRev = Math.min(...revenues);
                const maxRev = Math.max(...revenues);
                
                // Cr√©er des points pour la ligne (FDV = Revenu √ó Ratio)
                const numPoints = 50;
                for (let i = 0; i <= numPoints; i++) {
                    const logRev = Math.log10(minRev) + (Math.log10(maxRev) - Math.log10(minRev)) * (i / numPoints);
                    const rev = Math.pow(10, logRev);
                    const fdv = rev * avgRatio;
                    ratioLine.push({ x: rev, y: fdv });
                }
            }

            // Si le graphique existe, mettre √† jour les donn√©es avec animation
            if (chart) {
                // Mettre √† jour la ligne du ratio
                chart.data.datasets[0].data = ratioLine;
                chart.data.datasets[0].borderColor = lineColor;
                
                // Mettre √† jour les tokens live
                chart.data.datasets[1].data = liveTokens.map(p => ({
                    x: p.annualRevenue,
                    y: p.fdv,
                    name: p.name,
                    ratio: p.ratio,
                    logo: p.logo
                }));
                
                // Mettre √† jour les FDV estim√©es
                chart.data.datasets[2].data = estimatedTokens.map(p => ({
                    x: p.annualRevenue,
                    y: p.fdv,
                    name: p.name,
                    ratio: p.ratio,
                    logo: p.logo,
                    customApi: p.customApi
                }));
                
                // Mettre √† jour avec animation smooth
                chart.update('default');
                return;
            }

            // Sinon, cr√©er le graphique (premi√®re fois)
            // Pr√©charger les logos
            addLog('üñºÔ∏è Chargement des logos pour le graphique...', 'info');
            await preloadLogos(validProjects);

            // Configuration Chart.js
            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        // Ligne du ratio moyen
                        {
                            label: 'Ratio moyen pond√©r√©',
                            data: ratioLine,
                            type: 'line',
                            borderColor: lineColor,
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            fill: false,
                            tension: 0,
                            order: 2
                        },
                        // Tokens live
                        {
                            label: 'Token Live',
                            data: liveTokens.map(p => ({
                                x: p.annualRevenue,
                                y: p.fdv,
                                name: p.name,
                                ratio: p.ratio,
                                logo: p.logo
                            })),
                            backgroundColor: 'transparent',
                            borderColor: 'transparent',
                            pointRadius: 18, // Hitbox pour le tooltip
                            pointHoverRadius: 20,
                            order: 1
                        },
                        // FDV estim√©es
                        {
                            label: 'FDV Estim√©e',
                            data: estimatedTokens.map(p => ({
                                x: p.annualRevenue,
                                y: p.fdv,
                                name: p.name,
                                ratio: p.ratio,
                                logo: p.logo,
                                customApi: p.customApi
                            })),
                            backgroundColor: 'transparent',
                            borderColor: 'transparent',
                            pointRadius: 18,
                            pointHoverRadius: 20,
                            order: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 400,
                        easing: 'easeInOutQuart'
                    },
                    transitions: {
                        active: {
                            animation: {
                                duration: 300,
                                easing: 'easeInOutQuart'
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        x: {
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: 'Revenu Annuel (USD)',
                                font: { size: 14, weight: 'bold' }
                            },
                            ticks: {
                                callback: function(value) {
                                    // Afficher uniquement 1, 5, 10 et leurs puissances
                                    const log = Math.log10(value);
                                    const mantissa = value / Math.pow(10, Math.floor(log));
                                    if (Math.abs(mantissa - 1) < 0.01 || 
                                        Math.abs(mantissa - 5) < 0.01 || 
                                        Math.abs(mantissa - 10) < 0.01) {
                                        return formatUSD(value);
                                    }
                                    return '';
                                },
                                maxTicksLimit: 10
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: 'FDV (USD)',
                                font: { size: 14, weight: 'bold' }
                            },
                            ticks: {
                                callback: function(value) {
                                    const log = Math.log10(value);
                                    const mantissa = value / Math.pow(10, Math.floor(log));
                                    if (Math.abs(mantissa - 1) < 0.01 || 
                                        Math.abs(mantissa - 5) < 0.01 || 
                                        Math.abs(mantissa - 10) < 0.01) {
                                        return formatUSD(value);
                                    }
                                    return '';
                                },
                                maxTicksLimit: 10
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 12 },
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                title: function(context) {
                                    return context[0].raw.name || '';
                                },
                                label: function(context) {
                                    if (!context.raw.name) return '';
                                    const lines = [
                                        `Revenu Annuel: ${formatUSD(context.raw.x)}`,
                                        `FDV: ${formatUSD(context.raw.y)}`,
                                        `Ratio: ${formatRatio(context.raw.ratio)}`
                                    ];
                                    if (context.raw.customApi) {
                                        lines.push('');
                                        lines.push('‚ö†Ô∏è Donn√©es estim√©es (24h glissantes)');
                                    }
                                    return lines;
                                }
                            }
                        },
                        legend: {
                            display: false
                        },
                        datalabels: {
                            display: false // D√©sactiv√© car on dessine les labels dans logoPlugin
                        }
                    },
                    onHover: function(event, elements) {
                        const canvas = event.native.target;
                        if (elements.length > 0 && elements[0].datasetIndex > 0) {
                            canvas.style.cursor = 'pointer';
                            const newHovered = {
                                datasetIndex: elements[0].datasetIndex,
                                index: elements[0].index
                            };
                            if (!hoveredPoint || hoveredPoint.datasetIndex !== newHovered.datasetIndex || hoveredPoint.index !== newHovered.index) {
                                hoveredPoint = newHovered;
                                chart.draw();
                            }
                        } else {
                            canvas.style.cursor = 'default';
                            if (hoveredPoint !== null) {
                                hoveredPoint = null;
                                chart.draw();
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels, logoPlugin]
            });
        }

        // =====================================================
        // INITIALISATION
        // =====================================================
        
        // Charger les donn√©es au d√©marrage
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser le sc√©nario Bullish par d√©faut
            setScenario('bullish');
            
            loadAllData();
            
            // Actualisation automatique toutes les 24h
            setInterval(loadAllData, 24 * 60 * 60 * 1000);
        });
    </script>
</body>
</html>
